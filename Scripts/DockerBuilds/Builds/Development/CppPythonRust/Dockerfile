# This Dockerfile is automatically generated by con(cat)enating textfiles. It's
# automatically concatenated by running a shell script (e.g.
# SetupPyTorchGPUDocker.sh) or doing something like, in command line,
# cat Dockerfile.header Dockerfile.base ..


ARG BASE_IMAGE
FROM ${BASE_IMAGE}

# Set the working directory in the container
# https://docs.docker.com/engine/reference/builder/
ENV THIRD_PARTY=/ThirdParty
WORKDIR /

## Update apt, pip, and do pip installs.
RUN apt-get update



RUN apt-get -y install build-essential ccache libboost-all-dev \
  libtbb-dev

# Install prerequisites for Kitware repository
RUN apt-get install -y ca-certificates gpg wget
 
# If kitware-archive-keyring package hasn't been installed previously, manually
# obtain a copy of signing key:
RUN (test -f /usr/share/doc/kitware-archive-keyring/copyright) || \
  (wget -O - https://apt.kitware.com/keys/kitware-archive-latest.asc 2>/dev/null | \
    gpg --dearmor - | tee /usr/share/keyrings/kitware-archive-keyring.gpg >/dev/null) && \
  # Add repository to sources list and update.
  # For Ubuntu Jammy Jellyfish (22.04):
  echo 'deb [signed-by=/usr/share/keyrings/kitware-archive-keyring.gpg] \
    https://apt.kitware.com/ubuntu/ noble main' | \
      tee /etc/apt/sources.list.d/kitware.list >/dev/null && \
  apt-get update && \
  # If kitware-archive-keyring package hasn't been installed previously, remove
  # manually obtained signed key to make room for package:
  test -f /usr/share/doc/kitware-archive-keyring/copyright || \
  rm /usr/share/keyrings/kitware-archive-keyring.gpg && \
  # Install kitware-archive-keyring package to ensure keyring stays up to date
  # as kitware rotates keys.
  apt-get install kitware-archive-keyring && \
  apt-get install -y cmake  


RUN apt-get install -y python3-dev python3-pip
# Install Rust
RUN curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y && \
  # https://rust-lang.github.io/rustup/installation/index.html
  # export PATH once, doing both Rust and poetry binaries.
  echo "export PATH=/root/.cargo/bin:$PATH" >> $HOME/.bashrc



